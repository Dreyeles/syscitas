<!-- Modal Login -->
<div id="loginModal" class="modal fade" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" th:fragment="loginModal">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content login-modal-content">
      <div class="modal-header border-0 flex-column align-items-center bg-white pb-0">
        <img src="/img/logo.svg" alt="Logo SISOL" width="120" height="60" class="mb-2">
        <h5 class="modal-title w-100 text-center mb-0" id="loginModalLabel">Iniciar Sesión</h5>
        <button type="button" class="btn-close position-absolute end-0 top-0 m-3" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body pt-0">
        <!-- Alertas -->
        <div th:if="${param.error}" class="alert alert-danger mb-3" role="alert">
          Correo y/o contraseña incorrectos.
        </div>
        <div th:if="${param.logout}" class="alert alert-info mb-3" role="alert">
          Has cerrado sesión exitosamente.
        </div>
        <div th:if="${param.registroExitoso}" class="alert alert-success mb-3" role="alert">
          ¡Registro exitoso! Ya puedes iniciar sesión.
        </div>

        <!-- Formulario -->
        <form th:action="@{/auth/login}" method="post" id="loginForm" autocomplete="off">
          <div class="mb-3">
            <label for="correo" class="form-label">Correo electrónico</label>
            <input type="email" class="form-control" id="correo" name="username"
                   placeholder="usuario@correo.com" required autocomplete="username" autofocus>
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <div class="input-group">
              <input type="password" class="form-control" id="password" name="password"
                     placeholder="Contraseña" required autocomplete="current-password">
              <span class="input-group-text toggle-password" data-target="password">
                <i class="bi bi-eye-slash"></i>
              </span>
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
          </div>
        </form>

        <div class="mt-3 text-center">
          <a th:href="@{/auth/registro/mostrar}" class="btn btn-outline-primary w-100" id="btnRegistro">Registrarse</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<!-- Scripts -->
<script src="/js/password-toggle.js"></script>
<script src="/js/login-ajax.js"></script>


<script>
// Inicializar password toggle cuando el modal se muestre
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM cargado, configurando modal de login...');
    
    const loginModal = document.getElementById('loginModal');
    if (loginModal) {
        console.log('Modal de login encontrado');
        
        loginModal.addEventListener('shown.bs.modal', function() {
            console.log('Modal de login mostrado, inicializando toggles...');
            // Pequeño delay para asegurar que el DOM esté completamente listo
            setTimeout(function() {
                if (window.PasswordToggle) {
                    window.PasswordToggle.initialize();
                } else {
                    console.warn('PasswordToggle no está disponible');
                }
            }, 100);
        });
        
        // También inicializar si el modal ya está visible
        if (loginModal.classList.contains('show')) {
            console.log('Modal ya está visible, inicializando toggles...');
            if (window.PasswordToggle) {
                window.PasswordToggle.initialize();
            }
        }
    } else {
        console.warn('Modal de login no encontrado');
    }
});
</script>