<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sisol.sys_citas.mapper.AuthMapper">

    <resultMap id="usuarioSesionResultMap" type="com.sisol.sys_citas.dto.UsuarioSesionDTO">
        <id property="id" column="id"/>
        <result property="nombres" column="nombres"/>
        <result property="correo" column="Correo"/>
        <result property="contrasenia" column="ContraseÃ±a"/>
        <result property="rol" column="Rol"/>
        </resultMap>

    <select id="verificarCorreo" statementType="CALLABLE" resultMap="usuarioSesionResultMap">
        { call sp_verificacion_correo_activo(
            #{correo, mode=IN, jdbcType=VARCHAR}
        )
        }
    </select>

    <select id="existeCorreo" resultType="boolean">
        SELECT COUNT(*) > 0 FROM usuario WHERE correo = #{correo}
    </select>

    <select id="existeDni" resultType="boolean">
        SELECT COUNT(*) > 0 FROM paciente WHERE dni = #{dni}
    </select>

    <insert id="insertarUsuario" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO usuario (correo, contrasenia, rol, activo)
        VALUES (#{correo}, #{contrasenia}, #{rol}, #{activo})
    </insert>

    <insert id="insertarPaciente">
        INSERT INTO paciente (id, dni, nombres, apellidos, telefono, estado_civil, direccion, contacto_emergencia_nombre, contacto_emergencia_telefono, fecha_nacimiento, sexo, alergias, grupo_sanguineo)
        VALUES (#{id}, #{dni}, #{nombres}, #{apellidos}, #{telefono}, #{estadoCivil}, #{direccion}, #{contactoEmergenciaNombre}, #{contactoEmergenciaTelefono}, #{fechaNacimiento}, #{sexo}, #{alergias}, #{grupoSanguineo})
    </insert>

    <select id="obtenerNombrePaciente" resultType="string">
        SELECT CONCAT(nombres, ' ', apellidos) FROM paciente WHERE id = #{id}
    </select>

    <select id="obtenerNombreMedico" resultType="string">
        SELECT CONCAT(nombres, ' ', apellidos) FROM medico WHERE id = #{id}
    </select>

    <select id="obtenerNombrePersonalAdministrativo" resultType="string">
        SELECT CONCAT(nombres, ' ', apellidos) FROM personal_administrativo WHERE id = #{id}
    </select>

</mapper>